<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Open Headers - Dynamic Sources</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .app-logo {
            height: 40px;
            margin-right: 15px;
        }

        h1 {
            margin: 0;
            flex-grow: 1;
            text-align: center;
        }

        .import-export-controls {
            display: flex;
            gap: 8px;
        }

        .export-btn, .import-btn, .settings-btn {
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-left: 5px;
        }

        .import-btn {
            background-color: #17a2b8;
        }

        .settings-btn {
            background-color: #6f42c1;
        }

        .export-btn:hover {
            background-color: #218838;
        }

        .import-btn:hover {
            background-color: #138496;
        }

        .settings-btn:hover {
            background-color: #5e35b1;
        }

        /* Toast notification system */
        .toast-container {
            position: fixed;
            top: 75px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            width: 100%;
            max-width: 800px;
            pointer-events: none;
        }

        .toast-message {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            margin: 0 auto;
            text-align: center;
            animation: fadeIn 0.3s ease, fadeOut 0.5s ease 1.5s forwards;
            pointer-events: none;
            max-width: 90%;
        }

        .toast-message.success {
            background-color: rgba(40, 167, 69, 0.9);
        }

        .toast-message.error {
            background-color: rgba(220, 53, 69, 0.9);
        }

        .toast-message.info {
            background-color: rgba(23, 162, 184, 0.9);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        .totp-options {
            margin-top: 1rem;
            padding: 0.5rem;
            background-color: #f0f4f8;
            border-radius: 4px;
            border: 1px solid #cfd8e3;
        }

        .totp-options-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .totp-options-header h4 {
            margin: 0;
            color: #375a7f;
        }

        .totp-secret-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
        }

        .totp-secret-row label {
            font-weight: bold;
            min-width: 80px;
        }

        #totpSecretInput {
            flex-grow: 1;
            padding: 0.4rem;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-family: monospace;
        }

        .test-btn {
            background-color: #6f42c1;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.4rem 0.8rem;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .test-btn:hover {
            background-color: #5e35b1;
        }

        #totpPreview {
            margin-top: 0.5rem;
            padding: 0.5rem;
            background-color: #e0e0e0;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        #totpPreview h5 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            color: #375a7f;
        }

        .totp-code-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f9f9f9;
            padding: 0.5rem;
            font-family: monospace;
            font-size: 1.2rem;
            border-radius: 4px;
        }

        #totpCode {
            font-weight: bold;
            letter-spacing: 0.2em;
            color: #28a745;
        }

        #totpTimeRemaining {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .totp-help {
            margin-top: 0.8rem;
            font-size: 0.85rem;
            color: #666;
            background-color: #f8f9fa;
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #e2e6ea;
        }

        .totp-help code {
            background-color: #e9ecef;
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
<div class="header-container">
    <img src="./images/icon128.png" alt="Open Headers Logo" class="app-logo">
    <h1>Open Headers - Dynamic Sources</h1>
    <div class="import-export-controls">
        <button id="exportBtn" class="export-btn" title="Export sources to a file">Export</button>
        <button id="importBtn" class="import-btn" title="Import sources from a file">Import</button>
        <button id="settingsBtn" class="settings-btn" title="Application Settings">Settings</button>
    </div>
</div>
<div class="toast-container" id="toastContainer">
    <!-- Toast messages will be added here dynamically -->
</div>

<div class="controls">
    <!-- Row 0: Source Type Selection -->
    <div class="type-row">
        <label for="sourceType">Source Type:</label>
        <select id="sourceType">
            <option value="file">File</option>
            <option value="env">Environment Variable</option>
            <option value="http">HTTP Request</option>
        </select>
    </div>

    <!-- Row 1: Browse button/Input field based on source type -->
    <div class="source-row" id="fileSourceRow">
        <button id="browseBtn" class="browse-btn">Browse File</button>
        <span id="filePathDisplay">No file selected</span>
    </div>

    <div class="source-row hidden" id="envSourceRow">
        <label for="envNameInput">Environment Variable Name:</label>
        <input type="text" id="envNameInput" placeholder="Enter environment variable name" />
    </div>

    <div class="source-row hidden" id="httpSourceRow">
        <label for="httpUrlInput">URL:</label>
        <input type="text" id="httpUrlInput" placeholder="Enter URL (e.g., https://example.com)" />
        <div class="http-method-row">
            <label for="httpMethodSelect">Method:</label>
            <select id="httpMethodSelect">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="PATCH">PATCH</option>
                <option value="DELETE">DELETE</option>
            </select>
        </div>

        <!-- HTTP Request Options Tabs -->
        <div class="http-options-tabs">
            <div class="tab-buttons">
                <button class="tab-btn active" data-target="queryParamsTab">Query Params</button>
                <button class="tab-btn" data-target="headersTab">Headers</button>
                <button class="tab-btn" data-target="bodyTab">Body</button>
            </div>

            <!-- Query Params Tab -->
            <div class="tab-content active" id="queryParamsTab">
                <div class="params-container" id="queryParamsContainer">
                    <!-- Params will be added dynamically here -->
                </div>
                <button id="addQueryParamBtn" class="add-param-btn">Add Query Parameter</button>
            </div>

            <!-- Headers Tab -->
            <div class="tab-content" id="headersTab">
                <div class="params-container" id="headersContainer">
                    <!-- Headers will be added dynamically here -->
                </div>
                <button id="addHeaderBtn" class="add-param-btn">Add Header</button>
            </div>

            <!-- Body Tab -->
            <div class="tab-content" id="bodyTab">
                <div class="body-type-selector">
                    <select id="contentTypeSelect">
                        <option value="application/json">JSON</option>
                        <option value="application/x-www-form-urlencoded">Form URL Encoded</option>
                    </select>
                </div>

                <!-- Body for Form URL Encoded -->
                <div class="form-editor-container">
                    <textarea id="formBodyEditor" placeholder="key1:value1&#10;key2:value2&#10;...&#10;Keys and values are separated by :&#10;Rows are separated by new lines"></textarea>
                </div>

                <!-- Body for JSON -->
                <div class="json-editor-container">
                    <textarea id="jsonBodyEditor" placeholder="Enter JSON body"></textarea>
                </div>
            </div>
        </div>

        <!-- Add Auto-Refresh Options here -->
        <div class="refresh-options">
            <label for="refreshIntervalSelect">Auto-Refresh:</label>
            <select id="refreshIntervalSelect">
                <option value="none">No auto-refresh</option>
                <option value="1">Every 1 minute</option>
                <option value="5">Every 5 minutes</option>
                <option value="15">Every 15 minutes</option>
                <option value="30">Every 30 minutes</option>
                <option value="60">Every hour</option>
                <option value="custom">Custom...</option>
            </select>

            <div id="refreshIntervalCustomRow" class="custom-interval-row hidden">
                <input type="number" id="refreshIntervalCustom" min="1" max="1440" value="10">
                <span>minutes</span>
            </div>
        </div>
        <div class="totp-options">
            <div class="totp-options-header">
                <h4>TOTP Authentication:</h4>
                <label class="toggle-switch">
                    <input type="checkbox" id="enableTOTP">
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Enable TOTP</span>
                </label>
            </div>
            <div id="totpOptionsPanel" class="hidden">
                <div class="totp-secret-row">
                    <label for="totpSecretInput">TOTP Secret:</label>
                    <input type="text" id="totpSecretInput" placeholder="Enter TOTP secret key (base32 encoded)" />
                    <button id="testTOTPBtn" class="test-btn">Test TOTP</button>
                </div>
                <div id="totpPreview" class="hidden">
                    <h5>Current TOTP Code:</h5>
                    <div class="totp-code-display">
                        <span id="totpCode">------</span>
                        <span id="totpTimeRemaining"></span>
                    </div>
                </div>
                <div class="totp-help">
                    <p><strong>Usage:</strong> Use <code>_TOTP_CODE</code> in any URL, header, or body field to insert the generated code.</p>
                    <p>You can also specify custom parameters: <code>_TOTP_CODE(secret,period,digits)</code></p>
                    <p>Example: <code>verification_code=_TOTP_CODE</code> or <code>otp=_TOTP_CODE(SECRETKEY,30,6)</code></p>
                </div>
            </div>
        </div>

        <button id="testRequestBtn">Test Request</button>
        <div id="httpResponsePreview" class="hidden">
            <h4>Response Preview:</h4>
            <pre id="responseContent"></pre>
        </div>
        <div class="json-filter-container">
            <div class="json-filter-header">
                <h4>JSON Filter Options:</h4>
                <label class="toggle-switch">
                    <input type="checkbox" id="enableJsonFilter">
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Enable JSON Filter</span>
                </label>
            </div>
            <div id="jsonFilterOptions" class="hidden">
                <div class="json-path-row">
                    <label for="jsonPathInput">JSON Path:</label>
                    <input type="text" id="jsonPathInput" placeholder="e.g., root.access_token or root.employee.first_name">
                    <button id="testJsonPathBtn">Test Path</button>
                </div>
                <div id="jsonPathPreview" class="hidden">
                    <h5>Filtered Result:</h5>
                    <pre id="jsonPathResult"></pre>
                </div>
                <div class="json-path-help">
                    <p><strong>Path Format:</strong> Use dot notation to access nested objects. Example: <code>root.data.items[0].name</code></p>
                    <p>Start with <code>root</code> to reference the top level of the JSON response.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Row 2: Optional Tag input -->
    <div class="tag-row">
        <label for="tagInput">Tag (optional):</label>
        <input type="text" id="tagInput" placeholder="Enter a tag (optional)" />
    </div>

    <!-- Row 3: Add Source button (centered) -->
    <div class="add-source-row">
        <button id="addSourceBtn">Add Source</button>
    </div>
</div>

<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>Type</th>
        <th>Tag</th>
        <th>Source Path/URL</th>
        <th>Content</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody id="sourcesTableBody">
    <!-- Rows are appended dynamically -->
    </tbody>
</table>

<!-- Your front-end logic - Now using the bundled scripts -->
<script src="utils.js"></script>
<script src="source-form-controller.js"></script>
<script src="source-table-controller.js"></script>
<script src="renderer.js"></script>
<!-- Settings Dialog HTML -->
<div id="settingsDialog" class="dialog-overlay hidden">
    <div class="dialog-box settings-dialog">
        <h3>Application Settings</h3>
        <div class="dialog-content">
            <div class="settings-group">
                <h4>Startup Options</h4>
                <div class="setting-row">
                    <label class="toggle-switch">
                        <input type="checkbox" id="launchAtLogin">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Launch at login</span>
                    </label>
                </div>
                <div class="setting-row">
                    <label class="toggle-switch">
                        <input type="checkbox" id="hideOnLaunch">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Hide window on startup</span>
                    </label>
                </div>
            </div>

            <div class="settings-group">
                <h4>Appearance</h4>
                <div class="setting-row">
                    <label class="toggle-switch">
                        <input type="checkbox" id="showDockIcon">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Show Dock icon</span>
                    </label>
                </div>
                <div class="setting-row">
                    <label class="toggle-switch">
                        <input type="checkbox" id="showStatusBarIcon">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Show Status Bar icon</span>
                    </label>
                </div>
            </div>
        </div>
        <div class="dialog-buttons">
            <button id="settingsCancelBtn" class="dialog-button cancel-button">Cancel</button>
            <button id="settingsSaveBtn" class="dialog-button save-button">Save</button>
        </div>
    </div>
</div>
</body>
</html>